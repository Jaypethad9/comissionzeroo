{% extends "base.html" %}
{% load static %}
{% load humanize %}

{% block title %}Tender Details | Service Provider{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/service_provider/tender_detail.css' %}" />
{% endblock %}

{% block sidebar %}
{% include "sidebar_service.html" %}
{% endblock %}

{% block content %}
  <h1 class="text-primary text-center mb-4">Tender Details</h1>

  <div class="card shadow p-4">
    <h2 class="h4 text-dark">{{ tender.title }}</h2>

    <div class="row mb-3">
      <div class="col-md-4"><strong>Category:</strong> {{ tender.get_category_display }}</div>
      <div class="col-md-4"><strong>Urgency:</strong> {{ tender.get_urgency_display }}</div>
      <div class="col-md-4">
        <strong>Status:</strong>
        <span class="badge 
          {% if tender.status == 'open' %} bg-success 
          {% elif tender.status == 'ongoing' %} bg-warning text-dark 
          {% elif tender.status == 'completed' %} bg-secondary 
          {% else %} bg-info 
          {% endif %}">
          {{ tender.status|capfirst }}
        </span>
      </div>
    </div>

    <div class="row mb-3">
      <div class="col-md-4">
        <strong>Budget:</strong>
        {% if tender.budget %}
          ₹{{ tender.budget|intcomma }}
        {% else %}
          Not specified
        {% endif %}
      </div>
      <div class="col-md-4"><strong>Deadline:</strong> {{ tender.deadline|date:"F j, Y" }}</div>
      <div class="col-md-4"><strong>Start Date:</strong> {{ tender.start_date|default:"Not specified" }}</div>
    </div>

    <div class="mb-3">
      <strong>Address:</strong> {{ tender.address }}, {{ tender.postcode }}
    </div>

    <hr>

    <div class="mb-4">
      <h5>Description</h5>
      <p>{{ tender.description }}</p>
    </div>

    {% if tender.notes %}
    <div class="mb-4">
      <h5>Special Notes</h5>
      <p>{{ tender.notes }}</p>
    </div>
    {% endif %}

    {% if tender.images %}
    <div class="mb-4">
      <h5>Uploaded Image</h5>
      <img src="{{ tender.images.url }}" alt="Tender Image" class="img-fluid rounded shadow-sm" style="max-height: 300px;">
    </div>
    {% endif %}

    <!-- Actions -->
    <div class="d-flex flex-wrap gap-3 mt-4">
      <a href="{% url 'tenders' %}" class="btn btn-outline-secondary">
        ← Back to All Tenders
      </a>

      {% if not quotation or quotation.status == 'rejected' %}
        <a href="{% url 'submit_quotation' tender.id %}" class="btn btn-gradient">
          <i class="fas fa-file-signature me-1"></i> Submit Quote
        </a>
      {% else %}
        <button class="btn btn-gradient disabled" disabled>
          <i class="fas fa-file-signature me-1"></i> Submit Quote
        </button>
      {% endif %}
    </div>
  </div>
{% endblock %}
